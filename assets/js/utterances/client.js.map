{"version":3,"sources":["deparam.ts","preferred-theme.ts","client.ts"],"names":[],"mappings":"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","file":"client.js","sourceRoot":"..\\src","sourcesContent":["export function deparam(query: string): Record<string, string> {\r\n  let match: RegExpExecArray | null;\r\n  const plus = /\\+/g;\r\n  const search = /([^&=]+)=?([^&]*)/g;\r\n  const decode = (s: string) => decodeURIComponent(s.replace(plus, ' '));\r\n  const params: Record<string, string> = {};\r\n  // tslint:disable-next-line:no-conditional-assignment\r\n  while (match = search.exec(query)) {\r\n    params[decode(match[1])] = decode(match[2]);\r\n  }\r\n  return params;\r\n}\r\n\r\nexport function param(obj: Record<string, string>) {\r\n  const parts = [];\r\n  for (const name in obj) {\r\n    if (obj.hasOwnProperty(name) && obj[name]) {\r\n      parts.push(`${encodeURIComponent(name)}=${encodeURIComponent(obj[name])}`);\r\n    }\r\n  }\r\n  return parts.join('&');\r\n}\r\n","export const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches\r\n  ? 'github-dark'\r\n  : 'github-light';\r\n\r\nexport const preferredThemeId = 'preferred-color-scheme';","import { param, deparam } from './deparam';\r\nimport { ResizeMessage } from './measure';\r\nimport { preferredThemeId, preferredTheme } from './preferred-theme';\r\n\r\n// slice access token from query string\r\nconst params = deparam(location.search.substr(1));\r\nconst token = params.utterances;\r\nif (token) {\r\n  delete params.utterances;\r\n  let search = param(params);\r\n  if (search.length) {\r\n    search = '?' + search;\r\n  }\r\n  history.replaceState(undefined, document.title, location.pathname + search + location.hash);\r\n}\r\n\r\nlet script = document.currentScript as HTMLScriptElement;\r\nif (script === undefined) {\r\n  // Internet Explorer :(\r\n  // tslint:disable-next-line:max-line-length\r\n  script = document.querySelector('script[src^=\"https://utteranc.es/client.js\"],script[src^=\"http://localhost:4000/client.js\"]') as HTMLScriptElement;\r\n}\r\n\r\n// gather script element's attributes\r\nconst attrs: Record<string, string> = {};\r\nfor (let i = 0; i < script.attributes.length; i++) {\r\n  const attribute = script.attributes.item(i)!;\r\n  attrs[attribute.name.replace(/^data-/, '')] = attribute.value; // permit using data-theme instead of theme.\r\n}\r\nif (attrs.theme === preferredThemeId) {\r\n  attrs.theme = preferredTheme;\r\n}\r\n\r\n// gather page attributes\r\nconst canonicalLink = document.querySelector(`link[rel='canonical']`) as HTMLLinkElement;\r\nattrs.url = canonicalLink ? canonicalLink.href : location.origin + location.pathname + location.search;\r\nattrs.origin = location.origin;\r\nattrs.pathname = location.pathname.length < 2 ? 'index' : location.pathname.substr(1).replace(/\\.\\w+$/, '');\r\nattrs.title = document.title;\r\nconst descriptionMeta = document.querySelector(`meta[name='description']`) as HTMLMetaElement;\r\nattrs.description = descriptionMeta ? descriptionMeta.content : '';\r\n// truncate descriptions that would trigger 414 \"URI Too Long\"\r\nconst len = encodeURIComponent(attrs.description).length;\r\nif (len > 1000) {\r\n  attrs.description = attrs.description.substr(0, Math.floor(attrs.description.length * 1000 / len));\r\n}\r\nconst ogtitleMeta = document.querySelector(`meta[property='og:title'],meta[name='og:title']`) as HTMLMetaElement;\r\nattrs['og:title'] = ogtitleMeta ? ogtitleMeta.content : '';\r\nattrs.token = token;\r\n\r\n// create the standard utterances styles and insert them at the beginning of the\r\n// <head> for easy overriding.\r\n// NOTE: the craziness with \"width\" is for mobile safari :(\r\ndocument.head.insertAdjacentHTML(\r\n  'afterbegin',\r\n  `<style>\r\n    .utterances {\r\n      position: relative;\r\n      box-sizing: border-box;\r\n      width: 100%;\r\n      max-width: 760px;\r\n      margin-left: auto;\r\n      margin-right: auto;\r\n    }\r\n    .utterances-frame {\r\n      position: absolute;\r\n      left: 0;\r\n      right: 0;\r\n      width: 1px;\r\n      min-width: 100%;\r\n      max-width: 100%;\r\n      height: 100%;\r\n      border: 0;\r\n    }\r\n  </style>`);\r\n\r\n// create the comments iframe and it's responsive container\r\nconst utterancesOrigin = script.src.match(/^https:\\/\\/utteranc\\.es|http:\\/\\/localhost:\\d+/)![0];\r\nconst url = `${utterancesOrigin}/utterances.html`;\r\nscript.insertAdjacentHTML(\r\n  'afterend',\r\n  `<div class=\"utterances\">\r\n    <iframe class=\"utterances-frame\" title=\"Comments\" scrolling=\"no\" src=\"${url}?${param(attrs)}\"></iframe>\r\n  </div>`);\r\nconst container = script.nextElementSibling as HTMLDivElement;\r\nscript.parentElement!.removeChild(script);\r\n\r\n// adjust the iframe's height when the height of it's content changes\r\naddEventListener('message', event => {\r\n  if (event.origin !== utterancesOrigin) {\r\n    return;\r\n  }\r\n  const data = event.data as ResizeMessage;\r\n  if (data && data.type === 'resize' && data.height) {\r\n    container.style.height = `${data.height}px`;\r\n  }\r\n});\r\n"]}